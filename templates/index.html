{% extends "base.html" %}

{% block title %}HWA Neuromorphic Dashboard{% endblock %}

{% block header_title %}HWA/TWS Workload Dashboard{% endblock %}

{% block main_id %}dashboard-container{% endblock %}

{% block content %}
<!-- Summary Widgets will be dynamically loaded here -->
<section id="summary-widgets" class="summary-widgets-grid">
    <!-- Widgets are now generated by main.js from the layout config -->
</section>

<div id="loading-indicator">
    <p>Connecting to HWA/TWS environment...</p>
</div>
<div id="error-display" class="hidden"></div>

<!-- Job Streams Section -->
<section class="grid-section">
    <h2>Job Streams</h2>
    <div id="job-streams-grid" class="grid-container"></div>
</section>

<!-- Workstations Section -->
<section class="grid-section">
    <h2>Workstations</h2>
    <div id="workstations-grid" class="grid-container"></div>
</section>
{% endblock %}

{% block scripts %}
<!-- Inject layout data from backend -->
<script>
    const dashboardLayout = {{ layout_data|tojson|safe }};
</script>

<!-- Third-party libraries -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

<!-- Main application script -->
<script src="/static/js/main.js"></script>
<script>
    // Specific script for the shutdown button in the base template
    document.addEventListener('DOMContentLoaded', () => {
        const shutdownBtn = document.getElementById('shutdown-btn');
        if (shutdownBtn) {
            shutdownBtn.addEventListener('click', async () => {
                if (confirm('Are you sure you want to shut down the application?')) {
                    try { await fetch('/shutdown', { method: 'POST' }); }
                    finally { document.body.innerHTML = '<header><h1>Application Shut Down</h1></header><main><p>You can now close this browser tab.</p></main>'; }
                }
            });
        }
    });
</script>
{% endblock %}
